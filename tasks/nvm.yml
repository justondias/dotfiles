
- name: Check for nvm installation
  stat: "path=~/.nvm"
  register: nvm_install

- name: Install nvm
  shell: >
    curl https://raw.githubusercontent.com/creationix/nvm/v0.7.0/install.sh | sh
    creates=/home/{{ ansible_user_id }}/.nvm/nvm.sh
  when: not nvm_install.stat.exists
  become: yes
  become_user: j

- name: Install node and set version
  shell: >
    /bin/bash -c "source ~/.nvm/nvm.sh && nvm install --lts"
  when: not nvm_install.stat.exists
  become: yes
  become_user: j

